
<script>
var loadCSS = function(url, callback){
        var link = document.createElement('link');
        link.type = 'text/css';
        link.rel = 'stylesheet';
        link.href = url;
        link.id = 'theme-style';

        document.getElementsByTagName('head')[0].appendChild(link);

        var img = document.createElement('img');
        img.onerror = function(){
          if(callback) callback(link);
        }
        img.src = url;
      }
$(document).ready(function() {
        var initEditor = function() {
          $("textarea").sceditor({
            plugins: 'bbcode',
            style: "/assets/jquery.sceditor.default.min.css"
          });

    var html = giveFormat("<%= escape_javascript(@post.content)%>");
    var nestedDiv = document.getElementById("nested");
    nestedDiv.innerHTML = html;
    <%@comments.each do |comment|%>
      var html_comment=giveFormat("<%= escape_javascript(comment.content)%>");
      var commentDiv = document.getElementById("comment-<%=comment.id%>");
      commentDiv.innerHTML = html_comment;
    <%end%>
      function giveFormat(text)
      {
        var html = $("textarea").sceditor('instance').fromBBCode(text);
        
        return html;
      }
        };

        $("#theme").change(function() {
          var theme = "/assets/" + $(this).val() + ".min.css";

          $("textarea").sceditor("instance").destroy();
          $("link:first").remove();
          $("#theme-style").remove();

          loadCSS(theme, initEditor);
        });

        initEditor();
      });

    function setComment()
    {
      <%@editcomment.content="asdasd"%>
      <%@editcomment.id="1"%>
    }
     
    </script>

<div class="row">
<p id="notice"><%= notice %></p>

<p>
 
 <h1 align="center"> <%= @post.title %> </h1>
</p>
<div id="nested"></div>
<br>




<div class="col-lg-7">
<%if(@post.post_attatchments.size>0)%>
<h3>Archivos</h3>

<table class="table table-striped table-hover">
  <thead>
    <tr>  
      <th></th>
    </tr>
  </thead>
  <tbody>
    <%@post.post_attatchments.each do |attatchment| %>
    <tr class="active">
      <td>
     <a href="/post_attatchments/download/<%=attatchment.id%>"><%=attatchment.image_file_name%></a>   
    </td>
  <tr>
    <%end%>

  
  </tbody>
</table> 
<%end%>
<%if(current_user!=nil && current_user.rol=='admin')%>
<%= link_to 'Edit', edit_post_path(@post) %> |
<%end%>
<%= link_to 'Back', posts_index_path(@post.evento_id) %>
</div>

</div>
<div class="row">
  <%if(current_user!=nil)%>
	<div class="col-lg-10">
	<div class="well">
		<fieldset>
			<legend>Comentar:</legend>
			<%= form_for @comment do |f| %>
		  <div class="field">
			<%= f.label :content %><br>
			<%= f.text_area :content, :size => "100x15" %>
			<%= f.hidden_field :post_id,:value=>@post.id.to_s %><br>
			<input type="submit" class="btn btn-primary" value="Comentar">
	      </div>
	      <%end%>
	  </fieldset>
	</div>
	</div>
  <%else%>
  <h2>Debe ingresar al sistema para poder comentar</h2>
  <%end%>
	<%@comments.each do |comment|%>
	<%if comment.visible?%>
	<div class="row">
	<div class="col-lg-10">


		<div class="panel panel-default">

  <div class="panel-heading">Usuario</div>
  <div class="panel-body">
  	<div id="comment-<%=comment.id%>" class="ellipsis"></div><br>
    <%if(current_user!=nil && current_user==comment.user)%>
    <a href="/comments/<%=comment.id%>/edit">Editar</a>
    <%end%>

    
  </div>
</div>
		
		</div></div>
		<%end%>
	<%end%>
	<%= paginate @comments%>
</div>

